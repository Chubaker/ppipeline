pipeline {
    agent any
       
    stages {

        stage('Install requirements') {
            steps {
                echo 'Install requirements'
                sh 'pwd'
                //sh 'cp /tmp/aufgabe1/requirements.txt .'
                sh 'pip install -r requirements.txt'
            }
        }
        stage('SCP-Test'){
            steps {
               echo 'SCP-Test'
               sh 'scp requirements.txt jenkins@35.233.184.244:/tmp'
            }
        }
        
        stage('Start Flask WebApp') {
            steps {
                echo 'Start Flask WebApp'
                sh 'pwd'
                //sh 'cp /tmp/aufgabe1/app.py .'
                sh 'nohup /usr/bin/python3 app.py &'
            }
        }
        stage('Test') {
            steps {
                echo 'Test'
                sh 'pwd'
                //sh 'cp /tmp/aufgabe1/test.py .'
                sh '/usr/bin/python3 test.py'
            }
            post {
                always {
                    junit 'test-reports/*.xml'
                }
            }
        }
       
    }
}
